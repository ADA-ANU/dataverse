<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:o="http://omnifaces.org/ui"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                xmlns:iqbs="http://xmlns.jcp.org/jsf/composite/iqbs">


        <o:importFunctions type="edu.harvard.iq.dataverse.util.MarkupChecker" />
        <p class="help-block">
            <span class="glyphicon glyphicon-info-sign"/> #{bundle['file.downloadDialog.tip']}
        </p>
        <div class="form-horizontal">
            <div class="form-group" jsf:rendered="#{workingVersion.termsOfUseAndAccess.license != 'CC0' and !empty workingVersion.termsOfUseAndAccess.termsOfUse}">
                <label class="col-sm-3 control-label" for="guestbook_tou">
                    #{bundle['file.dataFilesTab.terms.list.termsOfUse.termsOfUse']}
                </label>
                <div class="col-sm-6">
                    <div class="panel panel-default">
                        <div class="panel-body read-terms">
                            <h:outputText value="#{MarkupChecker:sanitizeBasicHTML(workingVersion.termsOfUseAndAccess.termsOfUse)}" escape="false" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group" jsf:rendered="#{!empty workingVersion.termsOfUseAndAccess.termsOfAccess}">
                <label class="col-sm-3 control-label" for="guestbook_toa">
                    #{bundle['file.dataFilesTab.terms.list.termsOfAccess.termsOfsAccess']}
                </label>
                <div class="col-sm-6">
                    <div class="panel panel-default">
                        <div class="panel-body read-terms">
                            <h:outputText value="#{MarkupChecker:sanitizeBasicHTML(workingVersion.termsOfUseAndAccess.termsOfAccess)}" escape="false" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="button-block">
            <p:commandLink type="button" styleClass="btn btn-default" value="#{bundle.acceptTerms}" rendered="#{guestbookResponse.fileFormat != 'explore' 
                                                                               and guestbookResponse.fileFormat != 'subset'
                                                                                and guestbookResponse.fileFormat != 'worldMap'}"
                           actionListener="#{fileDownloadService.writeGuestbookAndStartDownload(guestbookResponse)}"
                           oncomplete="PF('downloadPopup').hide();">
            <!-- for Data Explorer -->
            <f:param name="DO_GB_VALIDATION" value="true"/>
+           <f:ajax execute="@form" render="@form"  onevent="showData(#{guestbookResponse.getDataFile().getId()},'','#{dataverseLocale.locale.language}')"/>
            <!-- end for Data Explorer -->
            </p:commandLink>
            <p:commandLink type="button" styleClass="btn btn-default" value="#{bundle.acceptTerms}" rendered="#{guestbookResponse.fileFormat == 'subset'}"
                           actionListener="#{fileDownloadService.writeGuestbookResponseRecord(guestbookResponse)}"
                           update="@form" oncomplete="PF('downloadPopup').hide(); PF('downloadDataSubsetPopup').show();">                                                  
            </p:commandLink>
            <p:commandLink type="button" styleClass="btn btn-default" rendered="#{guestbookResponse.fileFormat == 'worldMap'}"
                           actionListener="#{fileDownloadService.startWorldMapDownloadLink(guestbookResponse, null)}" 
                           oncomplete="PF('downloadPopup').hide();">
                #{bundle['acceptTerms']} 
            </p:commandLink>
            <p:commandLink type="button" styleClass="btn btn-default"  rendered="#{guestbookResponse.fileFormat == 'explore'}"
                           actionListener="#{fileDownloadService.startExploreDownloadLink(guestbookResponse, null)}"                           
                           oncomplete="PF('downloadPopup').hide();">
                #{bundle['acceptTerms']}
            <!-- for Data Explorer -->
            <f:param name="DO_GB_VALIDATION" value="true"/> 
+           <f:ajax execute="@form" render="@form"  onevent="showData(#{guestbookResponse.getDataFile().getId()},'#{twoRavensHelper.getApiTokenKey()}', '#{dataverseLocale.locale.language}')"/>
            <!-- end for Data Explorer -->
            </p:commandLink>
            <button type="button" class="btn btn-default" onclick="PF('downloadPopup').hide();PF('blockDatasetForm').hide();" value="#{bundle.cancel}">#{bundle.cancel}</button>
        </div>
</ui:composition>